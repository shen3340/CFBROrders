    name: FTP Deploy

    on:
      push:
        branches:
          - master

    jobs:
      ftp-deploy:
        runs-on: ubuntu-latest

        steps:
          # 1. Checkout code
          - name: Checkout code
            uses: actions/checkout@v3

          # 2. Setup .NET
          - name: Setup .NET
            uses: actions/setup-dotnet@v3
            with:
              dotnet-version: '8.0.x'

          # 3. Publish Blazor Server
          - name: Publish Blazor Server
            run: dotnet publish CFBROrders.Web/CFBROrders.Web.csproj -c Release -o publish

          # 4. List publish folder for debugging (ensures it exists)
          - name: List publish folder
            run: ls -la publish

          # 5. Touch DLLs and web.config to force deployment & server reload
          - name: Touch DLLs & restart server
            run: |
              touch publish/CFBROrders.Web.dll
              touch publish/CFBROrders.Web.pdb
              touch publish/web.config

          # 6. Deploy via FTP (incremental by default)
          - name: Deploy to FTP
            uses: SamKirkland/FTP-Deploy-Action@v4.3.6
            with:
              server: ${{ secrets.FTP_HOST }}
              username: ${{ secrets.FTP_USERNAME }}
              password: ${{ secrets.FTP_PASSWORD }}
              local-dir: ./publish/
              server-dir: ${{ secrets.FTP_PATH }}
              dry-run: false
